#!/usr/bin/env bash

set -euo pipefail

current_script_path=${BASH_SOURCE[0]}
plugin_dir=$(dirname "$(dirname "$current_script_path")")

# shellcheck source=./lib/utils.bash
source "${plugin_dir}/lib/utils.bash"

# Get the install path for this version
install_path="$ASDF_INSTALL_PATH"

# Find the Xcode.app for this version (xcodes installs directly to ASDF_INSTALL_PATH)
xcode_app=$(find "$install_path" -name "Xcode*.app" -type d | head -n1)
if [[ -n "$xcode_app" && -d "$xcode_app" ]]; then
	export DEVELOPER_DIR="$xcode_app/Contents/Developer"

	# Also use xcodes to select this version globally
	ensure_xcodes_installed
	if command -v xcodes &>/dev/null; then
		xcodes select "$xcode_app" 2>/dev/null || true
	fi
fi
